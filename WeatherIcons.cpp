#include "WeatherIcons.h"
#include <Adafruit_Protomatter.h>
#include "DisplayHelpers.h"

extern Adafruit_Protomatter matrix;

const uint8_t bitmap_sun_large[32] = {
  0b00000000, 0b00000000,
  0b00011000, 0b00000000,
  0b00111100, 0b00000000,
  0b01111110, 0b00000000,
  0b11111111, 0b00000000,
  0b11111111, 0b00000000,
  0b11111111, 0b00000000,
  0b01111110, 0b00000000,
  0b01111110, 0b00000000,
  0b11111111, 0b00000000,
  0b11111111, 0b00000000,
  0b11111111, 0b00000000,
  0b01111110, 0b00000000,
  0b00111100, 0b00000000,
  0b00011000, 0b00000000,
  0b00000000, 0b00000000
};

const uint8_t bitmap_cloud_large[128] = {
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b10000000, 0b00000000, 
0b00000000, 0b00011111, 0b11000000, 0b00000000, 0b00000000, 0b00011111, 0b11000000, 0b00000000, 
0b00000000, 0b00011111, 0b11111100, 0b00000000, 0b00000000, 0b01111111, 0b11111100, 0b00000000, 
0b00000000, 0b11111111, 0b11111100, 0b00000000, 0b00000001, 0b11111111, 0b11111111, 0b10000000, 
0b00000001, 0b11111111, 0b11111111, 0b10000000, 0b00000001, 0b11111111, 0b11111111, 0b10000000, 
0b00000000, 0b11111111, 0b11111111, 0b10000000, 0b00000000, 0b01111111, 0b11111111, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
};

const uint8_t bitmap_moon_large[32] = {
  0b00000111, 0b10000000,
  0b00011111, 0b11100000,
  0b00111111, 0b11110000,
  0b01111111, 0b11110000,
  0b01111111, 0b11100000,
  0b11111111, 0b10000000,
  0b11111111, 0b00000000,
  0b11111111, 0b00000000,
  0b11111111, 0b10000000,
  0b11111111, 0b11100000,
  0b01111111, 0b11110000,
  0b01111111, 0b11110000,
  0b00111111, 0b11100000,
  0b00011111, 0b11000000,
  0b00000111, 0b10000000,
  0b00000000, 0b00000000
};

const uint8_t bitmap_rain_large[32] = {
  0b00000111, 0b11000000,
  0b00011111, 0b11110000,
  0b00111111, 0b11111000,
  0b01111111, 0b11111100,
  0b01111111, 0b11111100,
  0b11111111, 0b11111110,
  0b11111111, 0b11111110,
  0b01111111, 0b11111100,
  0b00111111, 0b11111000,
  0b00011111, 0b11110000,
  0b00000111, 0b11000000,
  0b00001010, 0b10000000,
  0b00000100, 0b00000000,
  0b00001010, 0b10000000,
  0b00000100, 0b00000000,
  0b00001010, 0b10000000
};

uint16_t getIconColor(const String& iconCode) {
  if (iconCode.startsWith("01") || iconCode.startsWith("02")) {
    return getScaledColor(255, 255, 0);  // Yellow
  } else if (iconCode.startsWith("03") || iconCode.startsWith("04") || iconCode.endsWith("n")) {
    return getScaledColor(255, 255, 255);  // White
  } else if (iconCode.startsWith("09") || iconCode.startsWith("10") || iconCode.startsWith("11") || iconCode.startsWith("13")) {
    return getScaledColor(0, 128, 255);  // Blue
  } else {
    return getScaledColor(192, 192, 192);  // Fallback gray
  }
}

void drawWeatherIcon(const String& iconCode, int x, int y) {
  const uint8_t* iconBitmap = nullptr;
  uint8_t w = 8;
  uint8_t h = 8;

  if (iconCode.startsWith("01") || iconCode.startsWith("02")) {
    iconBitmap = bitmap_sun_large;
    w = 16;
    h = 16;
  } else if (iconCode.startsWith("03") || iconCode.startsWith("04")) {
    iconBitmap = bitmap_cloud_large;
    w = 32;
    h = 32;
  } else if (iconCode.endsWith("n")) {
    iconBitmap = bitmap_moon_large;
    w = 16;
    h = 16;
  } else if (iconCode.startsWith("09") || iconCode.startsWith("10") ||
             iconCode.startsWith("11") || iconCode.startsWith("13")) {
    iconBitmap = bitmap_rain_large;
    w = 16;
    h = 16;
  }

  if (iconBitmap) {
    matrix.drawBitmap(x, y, iconBitmap, w, h, getIconColor(iconCode));
  } else {
    matrix.setCursor(x, y);
    matrix.setTextColor(getScaledColor(192, 192, 192));
    matrix.print("?");
  }
}